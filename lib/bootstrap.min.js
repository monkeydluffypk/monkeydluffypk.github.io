var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,g,p){if(f==Array.prototype||f==Object.prototype)return f;f[g]=p.value;return f};
$jscomp.getGlobal=function(f){f=["object"==typeof globalThis&&globalThis,f,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var g=0;g<f.length;++g){var p=f[g];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(f,g){var p=$jscomp.propertyToPolyfillSymbol[g];if(null==p)return f[g];p=f[p];return void 0!==p?p:f[g]};$jscomp.polyfill=function(f,g,p,q){g&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(f,g,p,q):$jscomp.polyfillUnisolated(f,g,p,q))};
$jscomp.polyfillUnisolated=function(f,g,p,q){p=$jscomp.global;f=f.split(".");for(q=0;q<f.length-1;q++){var u=f[q];if(!(u in p))return;p=p[u]}f=f[f.length-1];q=p[f];g=g(q);g!=q&&null!=g&&$jscomp.defineProperty(p,f,{configurable:!0,writable:!0,value:g})};
$jscomp.polyfillIsolated=function(f,g,p,q){var u=f.split(".");f=1===u.length;q=u[0];q=!f&&q in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var F=0;F<u.length-1;F++){var G=u[F];if(!(G in q))return;q=q[G]}u=u[u.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?q[u]:null;g=g(p);null!=g&&(f?$jscomp.defineProperty($jscomp.polyfills,u,{configurable:!0,writable:!0,value:g}):g!==p&&(void 0===$jscomp.propertyToPolyfillSymbol[u]&&(p=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[u]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(u):$jscomp.POLYFILL_PREFIX+p+"$"+u),$jscomp.defineProperty(q,$jscomp.propertyToPolyfillSymbol[u],{configurable:!0,writable:!0,value:g})))};$jscomp.underscoreProtoCanBeSet=function(){var f={a:!0},g={};try{return g.__proto__=f,g.a}catch(p){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(f,g){f.__proto__=g;if(f.__proto__!==g)throw new TypeError(f+" is not extensible");return f}:null;$jscomp.arrayIteratorImpl=function(f){var g=0;return function(){return g<f.length?{done:!1,value:f[g++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};
$jscomp.makeIterator=function(f){var g="undefined"!=typeof Symbol&&Symbol.iterator&&f[Symbol.iterator];return g?g.call(f):$jscomp.arrayIterator(f)};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(f){if(!(f instanceof Object))throw new TypeError("Iterator result "+f+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(f){this.yieldResult=f};$jscomp.generator.Context.prototype.throw_=function(f){this.abruptCompletion_={exception:f,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(f){this.abruptCompletion_={return:f};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(f){this.abruptCompletion_={jumpTo:f};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(f,g){this.nextAddress=g;return{value:f}};$jscomp.generator.Context.prototype.yieldAll=function(f,g){f=$jscomp.makeIterator(f);var p=f.next();$jscomp.generator.ensureIteratorResultIsObject_(p);if(p.done)this.yieldResult=p.value,this.nextAddress=g;else return this.yieldAllIterator_=f,this.yield(p.value,g)};
$jscomp.generator.Context.prototype.jumpTo=function(f){this.nextAddress=f};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(f,g){this.catchAddress_=f;void 0!=g&&(this.finallyAddress_=g)};$jscomp.generator.Context.prototype.setFinallyBlock=function(f){this.catchAddress_=0;this.finallyAddress_=f||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(f,g){this.nextAddress=f;this.catchAddress_=g||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(f){this.catchAddress_=f||0;f=this.abruptCompletion_.exception;this.abruptCompletion_=null;return f};$jscomp.generator.Context.prototype.enterFinallyBlock=function(f,g,p){p?this.finallyContexts_[p]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=f||0;this.finallyAddress_=g||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(f,g){g=this.finallyContexts_.splice(g||0)[0];if(g=this.abruptCompletion_=this.abruptCompletion_||g){if(g.isException)return this.jumpToErrorHandler_();void 0!=g.jumpTo&&this.finallyAddress_<g.jumpTo?(this.nextAddress=g.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=f};$jscomp.generator.Context.prototype.forIn=function(f){return new $jscomp.generator.Context.PropertyIterator(f)};
$jscomp.generator.Context.PropertyIterator=function(f){this.object_=f;this.properties_=[];for(var g in f)this.properties_.push(g);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var f=this.properties_.pop();if(f in this.object_)return f}return null};$jscomp.generator.Engine_=function(f){this.context_=new $jscomp.generator.Context;this.program_=f};
$jscomp.generator.Engine_.prototype.next_=function(f){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,f,this.context_.next_);this.context_.next_(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(f){this.context_.start_();var g=this.context_.yieldAllIterator_;if(g)return this.yieldAllStep_("return"in g?g["return"]:function(p){return{value:p,done:!0}},f,this.context_.return);this.context_.return(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(f){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],f,this.context_.next_);this.context_.throw_(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(f,g,p){try{var q=f.call(this.context_.yieldAllIterator_,g);$jscomp.generator.ensureIteratorResultIsObject_(q);if(!q.done)return this.context_.stop_(),q;var u=q.value}catch(F){return this.context_.yieldAllIterator_=null,this.context_.throw_(F),this.nextStep_()}this.context_.yieldAllIterator_=null;p.call(this.context_,u);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var f=this.program_(this.context_);if(f)return this.context_.stop_(),{value:f.value,done:!1}}catch(g){this.context_.yieldResult=void 0,this.context_.throw_(g)}this.context_.stop_();if(this.context_.abruptCompletion_){f=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(f.isException)throw f.exception;return{value:f.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(f){this.next=function(g){return f.next_(g)};this.throw=function(g){return f.throw_(g)};this.return=function(g){return f.return_(g)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(f,g){g=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(g));$jscomp.setPrototypeOf&&f.prototype&&$jscomp.setPrototypeOf(g,f.prototype);return g};
$jscomp.asyncExecutePromiseGenerator=function(f){function g(q){return f.next(q)}function p(q){return f.throw(q)}return new Promise(function(q,u){function F(G){G.done?q(G.value):Promise.resolve(G.value).then(g,p).then(F,u)}F(f.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(f){return $jscomp.asyncExecutePromiseGenerator(f())};$jscomp.asyncExecutePromiseGeneratorProgram=function(f){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(f)))};
(()=>{function f(a){try{var b=new URL(a);return!!b&&"https:"===b.protocol}catch(c){return!1}}function g(a=!1){return embeddedservice_bootstrap.isLocalStorageAvailable&&a?localStorage:embeddedservice_bootstrap.isSessionStorageAvailable?sessionStorage:void 0}function p(){let a,b;const c=JSON.stringify({});embeddedservice_bootstrap.isLocalStorageAvailable&&!localStorage.getItem(v)&&(a=c,localStorage.setItem(v,a));embeddedservice_bootstrap.isSessionStorageAvailable&&!sessionStorage.getItem(v)&&(b=c,sessionStorage.setItem(v,
b));(a||b)&&X("ESW_3RDPARTY_STORAGE_SET_OBJECTS",{orgId:embeddedservice_bootstrap.settings.orgId,localStorageObj:a,sessionStorageObj:b});n("initializeWebStorage","web storage initialized")}function q(a,b=!0){let c;(b=g(b))&&(c=(b.getItem(v)&&JSON.parse(b.getItem(v))||{})[a]);return c}function u(a,b){if(b&&a){const c=b.getItem(v)&&JSON.parse(b.getItem(v))||{};Object.keys(a).forEach(d=>{c[d]=a[d]});0!==Object.keys(c).length&&b.setItem(v,JSON.stringify(c))}}function F(a,b,c=!0,d=!1){const e=g(c);if(e){const h=
e.getItem(v)&&JSON.parse(e.getItem(v))||{};h[a]=b;e.setItem(v,JSON.stringify(h));n("setItemInWebStorage",`${a} set in ${c?"localStorage":"sessionStorage"}`);d&&X("ESW_3RDPARTY_STORAGE_SET_ITEMS",{orgId:embeddedservice_bootstrap.settings.orgId,key:a,value:b,inLocalStorage:c})}}function G(a){embeddedservice_bootstrap.isLocalStorageAvailable&&!a&&localStorage.removeItem(v);embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.removeItem(v);X("ESW_3RDPARTY_STORAGE_CLEAR",embeddedservice_bootstrap.settings.orgId);
n("clearWebStorage","web storage cleared")}function Hb(){K=void 0;Aa=new Promise(b=>{Ba=b});M={};Y={};H=void 0;Ca=Da=O=I=!1;Z=aa=void 0;Ua();Va();Ib();n("clearInMemoryData","Cleared in-memory data.");const a=Wa();n("clearInMemoryData",`Reset conversationId. Old conversationId: ${A} & New conversationId: ${a}`);A=a}function Xa(a){const b=(c,d)=>{Object.keys(d).forEach(e=>{"object"===typeof c[e]&&typeof("object"===d[e])?b(c[e],d[e]):void 0===c[e]&&(c[e]=d[e])})};a&&"object"===typeof a&&b(embeddedservice_bootstrap.settings,
a)}function ba(a,b,c){if((c||embeddedservice_bootstrap.settings.devMode)&&console&&console[a])console[a]("[EmbeddedServiceBootstrap] "+(Array.isArray(b)?b.join(", "):b))}function n(a,b,c){ba("log",b,c);c={};Object.assign(c,{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",stateMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:"",convId:A,convType:w(),hostUrl:window.location.href});Ea(c)}function r(a,b){a?ba("warn","Warning: "+a,b):ba("warn","EmbeddedServiceBootstrap sent an anonymous warning.",
b)}function l(a,b,c,d){b?ba("error",b,d):ba("error","EmbeddedServiceBootstrap responded with an unspecified error.",d);d={};Object.assign(d,Object.assign({},{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",errMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:""},c&&{errCode:c},{convId:A,convType:w(),hostUrl:window.location.href}));Ea(null,d)}function Wa(){const a=new Uint32Array(32);crypto.getRandomValues(a);let b="";for(let c=0;32>c;c++){if(8===c||12===c||16===c||
20===c)b+="-";b=12===c?b+"4":16===c?b+"0123456789abcdef".charAt(a[c]&3|8):b+"0123456789abcdef".charAt(a[c]&15)}return b}function Fa(a,b,c){const d=document.createElementNS("http://www.w3.org/2000/svg",b);Object.getOwnPropertyNames(c).forEach(e=>{"children"===e?c.children.forEach(h=>{Fa(d,h.type,h)}):d.setAttribute(e,c[e])});a.appendChild(document.createTextNode("\n"));a.appendChild(d);a.appendChild(document.createTextNode("\n"))}function Ga(a){const b=document.createElementNS("http://www.w3.org/2000/svg",
"svg");if(a)return b.setAttribute("focusable","false"),b.setAttribute("aria-hidden","true"),b.setAttribute("viewBox","0 0 100 100"),Array.isArray(a)?a.forEach(c=>{Fa(b,c.type,c)}):Fa(b,"path",{d:a}),b;l("renderSVG","Invalid icon data.")}function Jb(){[{name:"document",object:document,functions:"addEventListener createAttribute createComment createDocumentFragment createElementNS createTextNode createRange getElementById getElementsByTagName getElementsByClassName querySelector querySelectorAll removeEventListener".split(" ")},
{name:"window",object:window,functions:"addEventListener clearTimeout dispatchEvent open removeEventListener requestAnimationFrame setInterval setTimeout fetch".split(" ")}].forEach(a=>{a.functions.forEach(b=>{b in a.object&&!Function.prototype.toString.call(a.object[b]).match(/\[native code\]/)&&r("EmbeddedService Messaging Bootstrap may not function correctly with this native JS function modified: "+a.name+"."+b,!0)})})}function oa(a){"string"!==typeof a?l("setAndStoreJwt",`Expected to receive string, instead received: ${a}.`):
(K=a,F(C.JWT,K))}function Kb(){window.addEventListener("message",Ya);embeddedservice_bootstrap.isLocalStorageAvailable&&window.addEventListener("storage",Za);pa()&&window.$A.eventService&&w()===x.EXP_SITE_AUTH&&window.$A.eventService.addHandler({event:"force:logout",handler:$a});try{(new PerformanceObserver(a=>{a.getEntries().forEach(b=>{"reload"===b.type&&t("EMBEDDED_MESSAGING_APP_AFTER_REFRESH")})})).observe({type:"navigation",buffered:!0})}catch(a){l("addEventHandlers",`Unable to initialize PerformanceObserver ${a}.`)}}
function Ya(a){if(a&&a.data&&a.origin)if(embeddedservice_bootstrap.filePreviewFrame&&embeddedservice_bootstrap.filePreviewFrame.contentWindow===a.source)switch(a.data.method){case "ESW_APP_SHOW_FILE_PREVIEW_FRAME":ab(!0);break;case "ESW_APP_HIDE_FILE_PREVIEW_FRAME":ab(!1);break;default:r("Unrecognized event name: "+a.data.method)}else if(embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.contentWindow===a.source)switch(a.data.method){case "ESW_3RDPARTY_STORAGE_READY":bb();
break;case "ESW_3RDPARTY_STORAGE_RESPONSE":a.data.data&&a.data.data.localStorage&&u(a.data.data.localStorage,localStorage);a.data.data&&a.data.data.sessionStorage&&u(a.data.data.sessionStorage,sessionStorage);cb();break;default:r("Unrecognized event name: "+a.data.method)}else if(0===J().indexOf(a.origin)&&embeddedservice_bootstrap.isMessageFromSalesforceDomain(a.origin)&&D().contentWindow===a.source){var b=D();switch(a.data.method){case "ESW_APP_READY_EVENT":Ba();break;case "ESW_APP_LOADED":a=z();
b=document.getElementById("embeddedMessagingIconContainer");let c=document.getElementById("embeddedMessagingIconChat"),d=document.getElementById("embeddedMessagingLoadingSpinner");D()||r("Embedded Messaging iframe not available for post-app-load updates.");a?(b&&d&&b.removeChild(d),c&&(c.style.display="none"),a.disabled=!1,a.classList.remove("embeddedMessagingConversationButtonLoading"),a.classList.add("embeddedMessagingConversationButtonLoaded"),a.classList.add("no-hover")):r("Embedded Messaging static button not available for post-app-load updates.");
db();O=!0;try{y("onEmbeddedMessagingInitSuccess")}catch(e){O=!1,l("emitEmbeddedMessagingInitSuccessEvent",`Something went wrong in firing onEmbeddedMessagingInitSuccess event ${e}.`)}break;case "ESW_APP_INITIALIZATION_ERROR":L();break;case "ESW_APP_MINIMIZE":embeddedservice_bootstrap.minimizeIframe(b,a.data.data);break;case "ESW_APP_MAXIMIZE":embeddedservice_bootstrap.maximizeIframe(b);break;case "ESW_APP_RESET_INITIAL_STATE":Q();break;case "ESW_SET_JWT_EVENT":oa(a.data.data);break;case "ESW_CLEAR_WEBSTORAGE_EVENT":G();
break;case "ESW_DOWNLOAD_FILE":Lb(a.data.data);break;case "ESW_SET_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=a.data.data;"object"!==typeof a?l("storeFailedMessagesInWebStorage",`Expected to receive object, instead received: ${a}.`):F(C.FAILED_OUTBOUND_MESSAGE_ENTRIES,a,!1);break;case "ESW_CLEAN_UP_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=C.FAILED_OUTBOUND_MESSAGE_ENTRIES;embeddedservice_bootstrap.isLocalStorageAvailable&&localStorage.getItem(v)&&(b=JSON.parse(localStorage.getItem(v))||{},delete b[a],localStorage.setItem(v,
JSON.stringify(b)));embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.getItem(v)&&(b=JSON.parse(sessionStorage.getItem(v))||{},delete b[a],sessionStorage.setItem(v,JSON.stringify(b)));n("removeItemInWebStorage",`${a} removed from web storage`);break;case "ESW_APP_UPDATE_TITLE_NOTIFICATION":Ua(a.data.data);break;case "ESW_APP_SEND_HIDDEN_PRECHAT_FIELDS":t("ESW_APP_RECEIVE_HIDDEN_PRECHAT_FIELDS",M);break;case "ESW_APP_SEND_AUTORESPONSE_PARAMETERS":t("ESW_APP_RECEIVE_AUTORESPONSE_PARAMETERS",
Y);break;case "EMBEDDED_MESSAGING_IDENTITY_TOKEN_EXPIRED_EVENT":w()!==x.AUTH?r("handleIdentityTokenExpiredEvent method called but User Verification isn\u2019t enabled in Messaging Settings."):y("onEmbeddedMessagingIdentityTokenExpired");break;case "EMBEDDED_MESSAGING_JWT_RETRIEVAL_FAILURE_EVENT":eb();break;case "ESW_APP_PRECHAT_SUBMIT":Mb(a.data.data);break;case "ESW_APP_SHOW_MINIMIZED_STATE_NOTIFICATION":(a=D())&&a.classList.add("hasMinimizedNotification");break;case "EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_EVENT":Nb();
break;case "EMBEDDED_MESSAGING_DISPATCH_EVENT_TO_HOST":y(a.data.data&&a.data.data.eventName,{detail:a.data.data.eventDetails||{}});break;case "EMBEDDED_MESSAGING_PUBLIC_SEND_TEXT_MESSAGE_API_RESPONSE":a=a.data.data;a.success?aa():Z(a.error);Z=aa=void 0;break;default:r("Unrecognized event name: "+a.data.method)}}else l("handleMessageEvent",`Unexpected message origin: ${a.origin}`)}function fb(){y("onEmbeddedMessagingButtonClicked");return gb()}function Za(a){a&&a.key&&a.key===v&&null===a.newValue&&
ca()&&Ha(!1,!0)}function $a(){n("handleAuraLogoutEvent","Received force:logout event in auth mode, proceeds to clear session");return embeddedservice_bootstrap.userVerificationAPI.clearSession()}function L(){O=!0;try{Ea(),y("onEmbeddedMessagingInitError")}catch(a){O=!1,l("emitEmbeddedMessagingInitErrorEvent",`Something went wrong in firing onEmbeddedMessagingInitError event ${a}.`)}}function qa(a){let b=ra()?!1:Ia()&&!embeddedservice_bootstrap.settings.hideChatButtonOnLoad;b=void 0!==a&&null!==a?
a:b;w()===x.AUTH&&(b=b&&sa(H));try{y("onEmbeddedMessagingChannelMenuVisibilityChanged",{detail:{devName:embeddedservice_bootstrap.settings.eswConfigDevName,isVisible:b}})}catch(c){l("emitEmbeddedMessagingChannelMenuVisibilityChangeEvent",`Something went wrong in firing emitEmbeddedMessagingChannelMenuVisibilityChange event ${c}.`)}}function y(a,b={detail:{}}){if(!a)throw Error(`Expected an eventName parameter with a string value. Instead received ${a}.`);if(b&&!("detail"in b))throw Error(`The options parameter of the event is malformed: ${b}.`);
try{"onEmbeddedMessagingConversationOpened"===a&&(Da=!0),window.dispatchEvent(new CustomEvent(a,b))}catch(c){throw Error("Something went wrong while dispatching the event "+a+":"+c);}}function Ua(a){if(a){const b=JSON.parse(a)[0],c=hb;da&&window.clearInterval(da);da=window.setInterval(()=>{document.title=document.title===b?c:b},1E3)}else window.clearInterval(da),da=void 0,document.title=hb}function R(){return document.getElementById("embedded-messaging")}function D(){return document.getElementById("embeddedMessagingFrame")}
function z(){return document.getElementById("embeddedMessagingConversationButton")}function ab(a){var b=D();if(embeddedservice_bootstrap.filePreviewFrame&&b){if(a){if(embeddedservice_bootstrap.filePreviewFrame.classList.add("show"),embeddedservice_bootstrap.filePreviewFrame.contentWindow.focus(),embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","false"),b.tabIndex="-1",b.setAttribute("aria-hidden","true"),b=R())b.inert=!0}else if(embeddedservice_bootstrap.filePreviewFrame.classList.remove("show"),
embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","true"),b.tabIndex="0",b.setAttribute("aria-hidden","false"),b=R())b.inert=!1;n("setFilePreviewFrameVisibility",`Full size file preview ${a?"shown":"hidden"}`)}}function Lb(a){let b;if(!f(a.attachmentDownloadURL))throw Error(`Invalid attachmentDownloadURL : ${a.attachmentDownloadURL}.`);b=document.createElement("iframe");b.style.display="none";b.src=a.attachmentDownloadURL||"";document.body.appendChild(b);a.shouldOpenFileInNewTab&&
window.open(b.src,"_blank","noreferrer noopener");setTimeout(()=>{document.body.removeChild(b)},1E3)}function ib(a){return new Promise((b,c)=>{let d=J(),e=document.createElement("link");e.id="embeddedMessagingBootstrapStyles";e.class="embeddedMessagingBootstrapStyles";e.href=d+"/assets/styles/bootstrap"+(embeddedservice_bootstrap.settings.devMode?"":".min")+".css";e.type="text/css";e.rel="stylesheet";e.onerror=c;e.onload=b;document.getElementsByTagName("head")[0].appendChild(e)})}function jb(){return Ja(embeddedservice_bootstrap.settings.scrt2URL+
"/embeddedservice/v1/embedded-service-config?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName+"&language="+embeddedservice_bootstrap.settings.language,"GET","getConfigurationData")}function Ka(){return Ja(embeddedservice_bootstrap.settings.scrt2URL+"/embeddedservice/v1/businesshours?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName,"GET","getBusinessHoursInterval").then(a=>
{a=a&&a.businessHoursInfo;n("getBusinessHoursInterval","Successfully retrieved Business Hours data");a&&Array.isArray(a.businessHours)&&0<a.businessHours.length&&(N={startTime:a.businessHours[0].startTime,endTime:a.businessHours[0].endTime},La())}).catch(a=>{throw a;})}function kb(a){l("handleBusinessHoursError","Failed to retrieve Business Hours data. Retrying the request.",a);return Ka()}function lb(){if(embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl){const a=embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl+
(pa()?"":"vforcesite")+"/_nc_external/system/security/session/SessionTimeServlet?buster="+(new Date).getTime();return Ja(a,"GET","getExpSiteSessionTimeout").then(b=>{try{b=JSON.parse(b.substring(b.indexOf("{"),b.indexOf("}")+1))}catch(c){l("getExpSiteSessionTimeout","Error parsing response text from server ",c)}b.sr&&(n("getExpSiteSessionTimeout","Successfully retrieved experience site session timeout"),0<b.sr?(Ma&&clearTimeout(Ma),z()||(q(C.JWT)?mb():embeddedservice_bootstrap.generateMarkup()),Ma=
setTimeout(()=>{lb()},1E3*b.sr)):embeddedservice_bootstrap.userVerificationAPI.clearSession())})}}function Ja(a,b,c){const d=performance.now();return new Promise((e,h)=>{const m=new XMLHttpRequest;m.open(b,a,!0);m.onreadystatechange=k=>{if((k=k.target)&&k.readyState===k.DONE||204===k.status){const ea=((performance.now()-d)/1E3).toFixed(3);if(200===k.status||204===k.status)if("getExpSiteSessionTimeout"!==c){const P=k.responseText?JSON.parse(k.responseText):k.responseText;e(P)}else e(k.responseText);
else h(k.status);n("sendXhrRequest",`${c?c:a} took ${ea} seconds and returned with the status code ${k.status}`)}};m.send()})}function Ob(){return ca()?nb().then(a=>ta().then(b=>{n("initializeConversationState","finished joining verified user conversation");ua(a,b)}).catch(()=>{L()})):w()===x.UNAUTH?ob()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?(ua(),Promise.resolve()):Na().then(a=>fa(M).then(b=>{n("initializeConversationState",
"finished creating conversation");ua(a,b)}).catch(()=>{L()})):Promise.reject(Error("Something went wrong initializing conversation state."))}function ua(a,b,c=!1){var d=q(C.FAILED_OUTBOUND_MESSAGE_ENTRIES,!1);const e=embeddedservice_bootstrap.settings.standardLabels,h=embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels;if(embeddedservice_bootstrap.settings.imageCompressionOptions){var m=embeddedservice_bootstrap.settings.imageCompressionOptions;m=Object.assign({},m.quality&&!isNaN(Number(m.quality))&&
0<=Number(m.quality)&&1>=Number(m.quality)&&{quality:Number(m.quality)},m.maxHeight&&!isNaN(Number(m.maxHeight))&&0<Number(m.maxHeight)&&{maxHeight:Number(m.maxHeight)},m.maxWidth&&!isNaN(Number(m.maxWidth))&&0<Number(m.maxWidth)&&{maxWidth:Number(m.maxWidth)},m.convertTypes&&("string"===typeof m.convertTypes||Array.isArray(m.convertTypes))&&{convertTypes:m.convertTypes},m.convertSize&&!isNaN(Number(m.convertSize))&&0<=Number(m.convertSize)&&{convertSize:m.convertSize})}m=Object.assign({},m&&{imageCompressionOptions:m},
"boolean"===typeof embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot&&{enableUserInputForConversationWithBot:!!embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot},"boolean"===typeof embeddedservice_bootstrap.settings.shouldShowParticipantChgEvntInConvHist&&{shouldShowParticipantChgEvntInConvHist:!!embeddedservice_bootstrap.settings.shouldShowParticipantChgEvntInConvHist},{shouldMinimizeWindowOnNewTab:embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab});
d=Object.assign({},embeddedservice_bootstrap.settings.embeddedServiceConfig,Object.assign({},{identityToken:H,failedMessages:d,conversationId:A,devMode:!!embeddedservice_bootstrap.settings.devMode,language:embeddedservice_bootstrap.settings.language},e&&{standardLabels:e},h&&{customLabels:h},{hasConversationButtonColorContrastMetA11yThreshold:pb.isValidContrastRatio("#FFFFFF",S("headerColor")),hostUrl:window.location.href},w()===x.EXP_SITE_AUTH&&{expSiteUrl:embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl},
{snippetSettings:m}))||{};a&&(d=Object.assign(d,{jwtData:a}));b&&(d=Object.assign(d,{conversationData:b}));d.isExistingSessionOnPageLoad=c;t("ESW_SET_CONFIG_EVENT",d)}function Mb(a){const b=Object.assign(a,M);y("onEmbeddedMessagingPreChatSubmitted",{detail:{prechatDisplay:Pb.CONVERSATION}});ca()?ta().then(c=>{c&&c.isExistingConversation?(n("handlePrechatSubmit","Pre-chat submitted but a conversation already exits for the verified user. Joining the existing conversation."),t("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",
c)):(n("handlePrechatSubmit","Pre-chat submitted. Creating a new conversation."),fa(b).then(d=>{t("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)}))}):w()===x.UNAUTH&&(q(C.JWT)?(n("handlePrechatSubmit","Pre-chat submitted but a JWT exists in web storage. Fetching existing conversations."),K=q(C.JWT),qb().then(c=>{t("ESW_SET_JWT_EVENT",c);ta().then(d=>{d&&d.isExistingConversation?(n("handlePrechatSubmit","Pre-chat submitted but a conversation already exits for the unverified user. Joining the existing conversation."),
t("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)):(n("handlePrechatSubmit","Pre-chat submitted and no existing conversations found. Creating a new conversation."),fa(b).then(e=>{t("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",e)}))})})):(n("handlePrechatSubmit","Pre-chat submitted. Fetching a JWT and starting a new conversation."),Na().then(c=>{t("ESW_SET_JWT_EVENT",c);fa(b).then(d=>{t("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)})})))}function rb(){return new Promise(a=>{embeddedservice_bootstrap.createFilePreviewFrame();
embeddedservice_bootstrap.createIframe().then(()=>{a("Created Embedded Messaging frame.")})})}function qb(){return q(C.JWT)?Qb().then(a=>{oa(a.accessToken);n("handleGetContinuityJwt","Sucessfully retreived a Continuity JWT");return a}).catch(a=>{l("handleGetContinuityJwt",`Failed to get Continuity JWT: ${a&&a.message?a.message:a}.`);Q()}):Promise.reject(void 0)}function Qb(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/continuityAccessToken");return T(a,
"GET","cors",null,null,"getContinuityJwt").then(b=>{if(!b.ok)throw b;return b.json()})}function Na(){return Rb().then(a=>{oa(a.accessToken);n("handleGetUnauthenticatedJwt","Successfully retreived an Unauthenticated JWT");return a}).catch(a=>Sb(a))}function Rb(){const a=embeddedservice_bootstrap.settings.orgId,b=embeddedservice_bootstrap.settings.eswConfigDevName;var c=sb();c=c?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken","?",c):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken");
return T(c,"POST","cors",{"Content-Type":"application/json"},{orgId:a,developerName:b,capabilitiesVersion:"248"},"getUnauthenticatedJwt").then(d=>{if(!d.ok)throw d;return d.json()})}function nb(){return(w()===x.EXP_SITE_AUTH?Tb():Ub()).then(a=>{a=w()===x.EXP_SITE_AUTH?a.data:a;oa(a.accessToken);n("handleGetAuthenticatedJwt","Successfully retreived an Authenticated JWT");return a}).catch(a=>{l("handleGetAuthenticatedJwt",`Error retrieving authenticated token: ${a&&a.message?a.message:a}.`);eb()})}
function Tb(){const a=embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl+"/miaw/auth/accesstoken"+`?platformType=${"Web"}&requestType=${"Community"}&developerName=${embeddedservice_bootstrap.settings.eswConfigDevName}&channelAddressIdentifier=${embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier||""}&capabilitiesVersion=${"248"}&deviceId="abcd"`;return ha(a,"GET","cors",null,null,"getExpSiteAuthenticatedJwt").then(b=>{if(!b.ok)throw b;
return b.json()}).catch(b=>va(b,a,"GET","cors",null,null,"getExpSiteAuthenticatedJwt"))}function Ub(){const a=embeddedservice_bootstrap.settings.orgId,b=embeddedservice_bootstrap.settings.eswConfigDevName,c=H,d=sb(),e=d?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken","?",d):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken"),h={"Content-Type":"application/json"},m={orgId:a,developerName:b,
capabilitiesVersion:"248",authorizationType:Oa.JWT,customerIdentityToken:c};return c&&sa(c)?ha(e,"POST","cors",h,m,"getAuthenticatedJwt").then(k=>{if(!k.ok)throw k;return k.json()}).catch(k=>va(k,e,"POST","cors",h,m,"getAuthenticatedJwt")):(new Promise(k=>{tb({apiPath:e,method:"POST",mode:"cors",requestHeaders:h,requestBody:m,resolve:k})})).then(k=>{if(!k.ok)throw k;return k.json()})}function Vb(){Wb().then(()=>{n("handleRegisterDeviceCapabilities","Successfully Registered Device Capabilities.")})}
function Wb(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/device/registerDeviceCapabilities");return T(a,"POST","cors",null,{},"registerDeviceCapabilities")}function ta(a){return Xb(!1,embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel?embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier:null).then(b=>{let c=[];if(!b.conversations||!Array.isArray(b.conversations))throw Error(`Invalid conversation list: ${b.conversations}.`);
c=b.conversations.filter(d=>0===d.endTimestamp);if(0===c.length){if(a)throw n("handleListConversation","No open conversation found, deleting stale data from web storage.",!0),r("No open conversation found, deleting stale data from web storage."),Q(),Error("No open conversation found for JWT in web storage.");return ob()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?null:(n("handleListConversation","No existing conversation found and pre-chat is not enabled. Will start a new conversation."),
r("No existing conversation found and pre-chat is not enabled. Will start a new conversation."),fa(M).then(d=>d))}1<c.length&&(n("handleListConversation",`Expected the user to be participating in 1 open conversation but instead found ${c.length}. Loading the conversation with latest startTimestamp.`),r(`Expected the user to be participating in 1 open conversation but instead found ${c.length}. Loading the conversation with latest startTimestamp.`),c.sort((d,e)=>e.startTimestamp-d.startTimestamp));
b=c[0];if(!Yb(b.conversationId))throw Error(`Invalid conversation identifier: ${b.conversationId}.`);n("handleListConversation","Successfully retrieved existing conversation");A!==b.conversationId&&(n("handleListConversation",`ConversationId change detected. Old conversation-id: ${A} & New conversation-id: ${b.conversationId}`),A=b.conversationId);b.isExistingConversation=!0;return b}).catch(b=>{l("handleListConversation",`Failed to list conversation entries: ${b&&b.message?b.message:b}.`);throw Error(`Failed to list conversation entries: ${b&&
b.message?b.message:b}.`);})}function Xb(a,b){const c=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/queries/conversation/list");return T(c,"POST","cors",null,Object.assign({},{includeClosedConversations:a},b&&{channelAddressIdentifier:b}),"listConversation").then(d=>d.json())}function Sb(a){if(a&&a.status&&401===a.status)return l("handleGetJwtError","Unauthorized error caused by JWT expiration. Attempt to get another JWT",a.status),Na().catch(b=>{throw Error(b);});throw Error(`Error retrieving unauthenticated token: ${a}.`);
}function ob(){return(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms||[]).some(a=>{a.formFields=a.formFields||[];return"PreChat"===a.formType&&0<a.formFields.length})}function fa(a){if(Ca)return l("handleCreateNewConversation","Attempting to create new conversation multiple times!",null,!0),Promise.resolve();Ca=!0;return Zb(a).then(b=>{y("onEmbeddedMessagingConversationStarted",{detail:{conversationId:A}});Vb();b.esDeveloperName=embeddedservice_bootstrap.settings.eswConfigDevName;
n("handleCreateNewConversation",`Initialized the esDeveloperName associated with current conversation to: ${embeddedservice_bootstrap.settings.eswConfigDevName}`);return b})}function Zb(a){const b=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation");return T(b,"POST","cors",null,Object.assign({},a&&{routingAttributes:a},{conversationId:A}),"createNewConversation").then(c=>c.json())}function $b(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation",
"/",A,"/transcript");return T(a,"GET","cors",null,null,"getTranscript").then(b=>b.arrayBuffer())}function Nb(){y("onEmbeddedMessagingTranscriptRequested",{detail:{conversationId:A}});$b().then(a=>{a=new Blob([a],{type:"octet/stream"});a=window.URL.createObjectURL(a);const b=document.createElement("a");b.href=a;b.download="ConversationTranscript.pdf";b.click();window.URL.revokeObjectURL(a);t("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_SUCCESS_EVENT");y("onEmbeddedMessagingTranscriptDownloadSuccessful",
{detail:{conversationId:A}})}).catch(a=>{if(a){const b=a.status;a=a.message||void 0;t("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT",{detail:{errorCode:b,errorMessage:a}});l("handleRequestTranscript",`Transcript request failed with status code: ${b} & message: ${a}`,b)}else t("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT");y("onEmbeddedMessagingTranscriptRequestFailed",{detail:{conversationId:A}})})}function ha(a,b,c,d,e,h=a){d=d?d:Object.assign({},{"Content-Type":"application/json"},K&&
{Authorization:"Bearer "+K});e=e?JSON.stringify(e):void 0;const m=performance.now();return fetch(a,Object.assign({},{method:b,mode:c,headers:d},e&&{body:e})).then(k=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const ea=((performance.now()-m)/1E3).toFixed(3);n("sendFetchRequest",`${h} took ${ea} seconds and returned with the status code ${k.status}`);if(!k.ok){let P;try{P=Object.assign(k,yield k.json())}catch(pc){P=Object.assign(k,{message:`Error reading the body stream of error object: ${k}`})}throw P;
}return k}))}function va(a,b,c,d,e,h,m=b){if(!a||!a.status||500<=a.status&&599>=a.status)return l("handleSendFetchRequestError",`Something went wrong in ${m}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}. Re-trying the request.`,a&&a.status),ha(b,c,d,e,h,m).catch(k=>{l("handleSendFetchRequestError",`${m} request failed again: ${k&&k.message?k.message:JSON.stringify(Object.assign({},k,{status:k.status,statusText:k.statusText,type:k.type}))}.`,
k&&k.status);throw k;});if(401===a.status){l("handleSendFetchRequestError",`${m}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}.`,a&&a.status);if(w()===x.UNAUTH)throw G(),a;if(ca())return H&&sa(H)||w()===x.EXP_SITE_AUTH?new Promise(k=>{ub({apiPath:b,method:c,mode:d,requestHeaders:e,requestBody:h,resolve:k})}):new Promise(k=>{tb({apiPath:b,method:c,mode:d,requestHeaders:e,requestBody:h,resolve:k})})}l("handleSendFetchRequestError",
`Something went wrong in ${m}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}`,a&&a.status);throw a;}function T(a,b,c,d,e,h){return ha(a,b,c,d,e,h).catch(m=>va(m,a,b,c,d,e,h))}function sb(){let a="";const b=Pa();b&&(a=(new URLSearchParams({os:b.os.name,osVersion:b.os.version,browser:b.browser.name,browserVersion:b.browser.version})).toString());return a}function Pa(){var a=[navigator.platform,navigator.userAgent,navigator.appVersion,
navigator.vendor,window.opera].join(" ");const b=vb(a,[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",
version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}]);a=vb(a,[{name:"Edge",value:"Edg",version:"Edg"},{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}]);return{os:b,browser:a}}function vb(a,b){let c;
let d;for(c=0;c<b.length;c+=1){var e=new RegExp(b[c].value,"i");if(e=e.test(a)){e=new RegExp(b[c].version+"[- /:;]([\\d._]+)","i");e=a.match(e);d="";e&&e[1]&&(e=e[1]);if(e)for(e=e.split(/[._]+/),a=0;a<e.length;a+=1)d=0===a?d+(e[a]+"."):d+e[a];else d="0";return{name:b[c].name,version:parseFloat(d)}}}return{name:"unknown",version:0}}function J(){try{return embeddedservice_bootstrap.settings.siteURL}catch(a){l("getSiteURL",`Error getting Site URL: ${a}`)}}function E(a,b){for(const c of embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels)if(c.sectionName===
a&&c.labelName===b)return c.labelValue||"";for(const c of embeddedservice_bootstrap.settings.standardLabels)if(c.sectionName===a&&c.labelName===b)return c.labelValue||"";return""}function S(a){for(const b of embeddedservice_bootstrap.brandingData)if(b.n&&b.n===a)return b.v}function ac(){const a=embeddedservice_bootstrap.settings.chatButtonPosition;if("string"===typeof a&&0<a.length){const b=a.split(",");2!==b.length?l("setButtonPositionStyles",`Invalid embeddedservice_bootstrap.settings.chatButtonPosition value specified: ${a}. Valid format is "25px, 30px".`):
(document.documentElement.style.setProperty("--eswButtonBottom",b[0].trim()),document.documentElement.style.setProperty("--eswButtonRight",b[1].trim()))}}function wb(){let a=z(),b=document.getElementById("embeddedMessagingIconContainer"),c=document.getElementById("embeddedMessagingIconChat"),d=document.createElement("div"),e=document.createElement("span"),h,m=1;if(a){c.style.display="none";d.setAttribute("class","embeddedMessagingLoadingSpinner");for(d.setAttribute("id","embeddedMessagingLoadingSpinner");13>
m;m++)h=document.createElement("div"),h.setAttribute("class","embeddedMessagingLoadingCircle"+m+" embeddedMessagingLoadingCircle"),d.appendChild(h);d.classList.add("embeddedMessagingIconLoading");a.classList.add("embeddedMessagingConversationButtonLoading");b.insertBefore(d,c);a.disabled=!0;e.className="slds-assistive-text";e.setAttribute("role","alert");e.innerHTML=E("EmbeddedMessagingPrechat","PrechatSubmitButtonLoading")||"Loading";d.appendChild(e)}}function Ia(){if(!N)return!0;const a=Number(N.startTime),
b=Number(N.endTime),c=Date.now();return c>=a&&c<b?!0:!1}function La(){let a;if(N){var b=Ia();b?a=Number(N.endTime):(a=Number(N.startTime),y("onEmbeddedMessagingBusinessHoursEnded"));isNaN(a)||(ia&&clearTimeout(ia),ia=setTimeout(()=>{clearTimeout(ia);ia=void 0;bc(b);b?y("onEmbeddedMessagingBusinessHoursEnded"):y("onEmbeddedMessagingBusinessHoursStarted")},a-Date.now()))}}function bc(a){a?(N=void 0,embeddedservice_bootstrap.utilAPI.hideChatButton(),Ka().then(La()).catch(b=>kb(b))):(ja()||embeddedservice_bootstrap.utilAPI.showChatButton(),
La())}function cc(){const a=!!navigator.userAgent.match(/iP(hone|ad|od)/i);var b=navigator.userAgent.match(/(?!=OS)(([0-9]){2})/i);b=b&&0<b.length?Number(b[0]):-1;const c=!!navigator.userAgent.match(/WebKit/i)&&!navigator.userAgent.match(/CriOS/i);return a&&c&&15<=b}function ja(){try{return embedded_svc&&embedded_svc.menu?!0:!1}catch(a){return!1}}function wa(){return embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===xb.LWR||pa()}function pa(){return embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===
xb.AURA}function ra(){return embeddedservice_bootstrap.settings.displayMode===dc.INLINE}function Qa(a){const b=embeddedservice_bootstrap.settings.targetElement.children;let c;for(const d in b)c=b[d],c!==R()&&c!==embeddedservice_bootstrap.filePreviewFrame&&(c.inert=a)}function yb(){const a=document.querySelector('meta[name="viewport"]');a&&(a.setAttribute("content",U),U=void 0)}function t(a,b){Aa.then(()=>{const c=D();if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);
c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),J()):r(`Embedded Messaging iframe not available for post message with method ${a}.`)})}function X(a,b){ec.then(()=>{const c=embeddedservice_bootstrap.siteContextFrame;if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),J()):r(`Embedded Messaging iframe not available for post message with method ${a}.`)})}
function zb(){X("ESW_PREFETCH_LWR_RESOURCES")}function fc(a){a||l("handleAuraSite","Failed to load aura app. Iframe is undefined.");a.src=J()+"/embeddedService/embeddedService.app"}function gc(a){let b=J();a||l("handleLWRSite","Failed to load LWR site. Iframe is undefined.");b.endsWith("/")||(b+="/");a.src=b+"?lwc.mode="+(embeddedservice_bootstrap.settings.devMode?"dev":"prod")}function gb(){return new Promise((a,b)=>{try{let c=z(),d=D();if(c&&!c.classList.contains("embeddedMessagingConversationButtonLoaded")){if(q(C.JWT))return n("handleClick",
"Conversation button clicked but a JWT exists in web storage. Joining the existing conversation."),K=q(C.JWT),Ab(!1).then(()=>{a()}).catch(e=>{L();l("handleClick",e.message);b(e)});F(C.CONVERSATION_BUTTON_CLICK_TIME,Date.now(),!0,!0);wb();n("handleClick","Conversation button clicked");rb().then(()=>{a()}).catch(e=>{l("handleClick",e.message);b(e)});Ob().catch(e=>{L();l("handleClick",e.message);b(e)})}else c&&c.classList.contains("embeddedMessagingConversationButtonLoaded")&&d&&d.classList&&d.classList.contains("isMaximized")?
t("ESW_APP_MINIMIZE"):l("handleClick","Something went wrong handling button click event.")}catch(c){b(c)}})}function hc(a){let b=D();a&&a.key&&(a.key===ka.SPACE||a.key===ka.ENTER?(a.preventDefault(),fb()):a.key===ka.TAB&&a.shiftKey&&b&&b.classList&&b.classList.contains("isMaximized")&&(a.preventDefault(),t("trapfocustolast")))}function ic(){const a=document.getElementById("embeddedMessagingMinimizedNotification"),b=z();a&&a.parentNode.removeChild(a);b&&b.focus()}function jc(a){if(a.key===ka.ENTER||
a.key===ka.SPACE)a.preventDefault(),this.handleNotificationDimissButtonClick()}function Ab(a){if(q(C.JWT))return wb(),rb().catch(l),qb().then(b=>{ta(a).then(c=>{ua(b,c,a)})}).catch(l)}function mb(){K=q(C.JWT);const a=embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier||"",b=(Bb(K)||{}).channelAddId||"";embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel&&a!==b?embeddedservice_bootstrap.userVerificationAPI.clearSession():
(embeddedservice_bootstrap.generateMarkup(!0),Ab(!0))}function Q(a){n("resetClientToInitialState","Resetting client to initial state.");try{G(a),Hb(),p()}catch(b){l("resetClientToInitialState",`Error on clearing web storage for the previously ended conversation: ${b}`)}la&&"function"===typeof la&&(la(),la=void 0);U&&yb();Ra.test(navigator.userAgent)&&Qa(!1);embeddedservice_bootstrap.removeMarkup();w()===x.UNAUTH&&(embeddedservice_bootstrap.generateMarkup(),z()&&z().focus());n("resetClientToInitialState",
"Successfully reset client to initial state.")}function kc(){const a=document.createElement("div");a.id="embeddedMessagingModalOverlay";return a}function Ea(a,b){a&&xa.currentStateLogs.push(a);b&&xa.errorLogs.push(b);Aa.then(()=>{t("EMBEDDED_MESSAGING_PUSH_PARENT_FRAME_LOGS",{pendingLogs:xa});Va()})}function Va(){xa={currentStateLogs:[],errorLogs:[]}}function Sa(){}function Ha(a,b){D()?t("EMBEDDED_MESSAGING_CLEAR_USER_SESSION_EVENT",a):Q(b)}function ub(a){return new Promise(b=>{n("renewAuthenticatedJwt",
"Renewing Authenticated JWT");nb().then(()=>{Cb(a);b()})})}function Cb(a){a&&ha(a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody).then(b=>{a.resolve&&"function"===typeof a.resolve&&a.resolve(b)}).catch(b=>va(b,a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody))}function tb(a){if(a){y("onEmbeddedMessagingIdentityTokenExpired");var b=new Promise(d=>{ma=d}),c=new Promise((d,e)=>{setTimeout(()=>{e()},3E4)});Promise.race([b,c]).then(()=>{n("handleIdentityTokenExpiry","Valid identity token found. Fetch authenticated JWT.");
a.apiPath.includes("/accessToken")?(a.requestBody.customerIdentityToken=H,Cb(a)):ub(a)}).catch(()=>{l("handleIdentityTokenExpiry","Failed to fetch authenticated JWT due to setIdentityToken timeout or other error. Clearing the messaging session on all tabs.");Ha(!1,!1)})}}function eb(){let a;Q(!1);embeddedservice_bootstrap.generateMarkup();a=z();var b=document.getElementById("embeddedMessagingIconChat");var c=document.getElementById("embeddedMessagingIconContainer");if(a){a.style.display="block";a.setAttribute("tabindex",
-1);a.style.setProperty("cursor","default");a.classList.add("no-hover");c&&b&&c.removeChild(b);b=Ga(ya.REFRESH);b.setAttribute("id","embeddedMessagingIconRefresh");b.setAttribute("class","embeddedMessagingIconRefresh");c.appendChild(b);c=document.createElement("div");b=document.createElement("div");const e=document.createElement("span"),h=document.createElement("span");var d=document.createElement("button");const m=document.createElement("span"),k=document.createElement("span");d.className="embeddedMessagingMinimizedNotificationDismissButton";
d.addEventListener("click",ic);d.addEventListener("keydown",jc);d.setAttribute("aria-describedby","dismissButton-help");m.className="embeddedMessagingMinimizedNotificationDismissButtonText";m.title=E("EmbeddedMessagingMinimizedState","NotificationDismissButtonText")||"Dismiss";m.innerHTML=E("EmbeddedMessagingMinimizedState","NotificationDismissButtonText")||"Dismiss";m.style.setProperty("font-family",S("font"));k.className="slds-assistive-text";k.id="dismissButton-help";k.innerHTML=E("EmbeddedMessagingMinimizedState",
"MinimizedNotificationDismissButtonAssistiveText")||"Close the chat notification";d.appendChild(m);d.appendChild(k);c.id="embeddedMessagingMinimizedNotification";c.className="embeddedMessagingMinimizedNotification";b.className="embeddedMessagingMinimizedNotificationTextWrapper";e.className="embeddedMessagingMinimizedNotificationText";e.role="status";e.title=E("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation.";
e.innerHTML=E("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation.";e.style.setProperty("font-family",S("font"));h.className="slds-assistive-text";h.innerHTML=E("EmbeddedMessagingMinimizedState","MinimizedNotificationAssistiveText")||"Expand the text.";b.appendChild(e);b.appendChild(h);c.appendChild(b);c.appendChild(d);a.disabled=!0;embeddedservice_bootstrap.settings.targetElement.appendChild(c)}}function Bb(a){a=
a.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");a=decodeURIComponent(window.atob(a).split("").map(function(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)}function sa(a){let b,c;if(!a)return embeddedservice_bootstrap.settings.devMode&&n("validateJwt","Empty jwt parameter passed in - skipping validation."),!1;try{return b=Bb(a),c=Math.floor(Date.now()/1E3)<b.exp,embeddedservice_bootstrap.settings.devMode&&!c&&n("validateJwt",`JWT has expired at ${(new Date(1E3*
b.exp)).toString()}`),c}catch(d){return embeddedservice_bootstrap.settings.devMode&&l("validateJwt",`JWT validation failed: ${d.message}`),!1}}function w(){let a=null;try{a=embeddedservice_bootstrap.settings.embeddedServiceConfig&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode}catch(b){l("getAuthMode",`Failed to retrieve auth mode flag: ${b.message}`)}return a}
function ca(){return w()===x.AUTH||w()===x.EXP_SITE_AUTH}function na(){}function Db(a,b,c,d){const e="setHiddenPrechatFields"===a;var h=e?lc():V();const m=h.map(({name:k})=>k);h=h.find(k=>k.name===b);if(!m.includes(b))return l("validatePrechatField",`${a} called with an invalid field name ${b}.`),!1;if("string"===typeof c&&(c.toLowerCase().includes("javascript:")||c.toLowerCase().includes("<script>")))return l("validatePrechatField",`JavaScript isn't allowed in the value for the ${b} field when calling ${a}.`),
!1;if(e){if(c.length>h.maxLength)return l("validatePrechatField",`Value for the ${b} field in ${a} exceeds the maximum length restriction of ${h.maxLength} characters.`),!1;if("string"!==typeof c)return l("validatePrechatField",`You must specify a string for the ${b} field in ${a} instead of a ${typeof c} value.`),!1}return d&&"boolean"!==typeof d?(l("validatePrechatField","setVisiblePrechatFields was called with isEditableByEndUser set to a value that\u2019s not boolean. Enter a boolean value."),
!1):!0}function lc(){let a=[];var b=Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields)?!0:!1;b&&(a=embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields);return a}function V(){return Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&
Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields.length?embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields:[]}function za(a){return I?!0:(l("shouldProcessPrechatFieldsFromHost",`Can't call ${a} before the onEmbeddedMessagingReady event is fired.`),!1)}function Yb(a){return"string"===typeof a&&0<a.trim().length?!0:!1}function Ib(){V().forEach(a=>{delete a.value;
delete a.isEditableByEndUser})}function Ta(){}function Eb(a){return I?!0:(l("shouldProcessAutoResponseParametersFromHost",`[${a}] Cannot invoke Auto-Response API before the onEmbeddedMessagingReady event is fired.`),!1)}function W(){}function B(){this.settings={devMode:!1,targetElement:document.body};this.isSessionStorageAvailable=this.isLocalStorageAvailable=!0;Object.defineProperties(ya,{CHAT:{value:"M50 0c27.614 0 50 20.52 50 45.833S77.614 91.667 50 91.667c-8.458 0-16.425-1.925-23.409-5.323-13.33 6.973-21.083 9.839-23.258 8.595-2.064-1.18.114-8.436 6.534-21.767C3.667 65.54 0 56.08 0 45.833 0 20.52 22.386 0 50 0zm4.583 61.667H22.917a2.917 2.917 0 000 5.833h31.666a2.917 2.917 0 000-5.833zm12.5-15.834H22.917a2.917 2.917 0 000 5.834h44.166a2.917 2.917 0 000-5.834zM79.583 30H22.917a2.917 2.917 0 000 5.833h56.666a2.917 2.917 0 000-5.833z"},
MINIMIZE_MODAL:{value:"M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2 c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"},REFRESH:{value:"M46.5,4h-3C42.7,4,42,4.7,42,5.5v7c0,0.9-0.5,1.3-1.2,0.7l0,0c-0.3-0.4-0.6-0.7-1-1c-5-5-12-7.1-19.2-5.7 c-2.5,0.5-4.9,1.5-7,2.9c-6.1,4-9.6,10.5-9.7,17.5c-0.1,5.4,2,10.8,5.8,14.7c4,4.2,9.4,6.5,15.2,6.5c5.1,0,9.9-1.8,13.7-5 c0.7-0.6,0.7-1.6,0.1-2.2l-2.1-2.1c-0.5-0.5-1.4-0.6-2-0.1c-3.6,3-8.5,4.2-13.4,3c-1.3-0.3-2.6-0.9-3.8-1.6 C11.7,36.6,9,30,10.6,23.4c0.3-1.3,0.9-2.6,1.6-3.8C15,14.7,19.9,12,25.1,12c4,0,7.8,1.6,10.6,4.4c0.5,0.4,0.9,0.9,1.2,1.4 c0.3,0.8-0.4,1.2-1.3,1.2h-7c-0.8,0-1.5,0.7-1.5,1.5v3.1c0,0.8,0.6,1.4,1.4,1.4h18.3c0.7,0,1.3-0.6,1.3-1.3V5.5 C48,4.7,47.3,4,46.5,4z"}});
this.brandingData=[]}function mc(){const a=document.createElement("iframe"),b=new URL(`${J()}/assets/htdocs/sitecontext${embeddedservice_bootstrap.settings.devMode?"":".min"}.html`);b.searchParams.set("parent_domain",window.location.origin);embeddedservice_bootstrap.settings.devMode&&b.searchParams.set("dev_mode",!0);a.classList.add("embeddedMessagingSiteContextFrame");a.id="embeddedMessagingSiteContextFrame";a.name="embeddedMessagingSiteContextFrame";a.src=b.href;a.onload=()=>{n("createSiteContextFrame",
"Created an iframe for siteContext.")};embeddedservice_bootstrap.siteContextFrame=a;document.body.appendChild(a)}const ya={},x={AUTH:"Auth",UNAUTH:"UnAuth",EXP_SITE_AUTH:"ExperienceSiteAuth"},Pb={CONVERSATION:"Conversation",SESSION:"Session"},dc={INLINE:"inline",POPUP:"default"};class pb{static isValidContrastRatio(a,b,c=3){return this.getContrastRatio(a,b)>=c}static getContrastRatio(a,b){a=this.convertHexToRGB(a);b=this.convertHexToRGB(b);a=this.getRelativeLuminance(a);b=this.getRelativeLuminance(b);
return((Math.max(a,b)+.05)/(Math.min(a,b)+.05)).toFixed(2)}static getRelativeLuminance(a){const [b,c,d]=Object.values(a).map(e=>this.getSRGB(e));return.2126*b+.7152*c+.0722*d}static getSRGB(a){a/=255;return.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)}static convertHexToRGB(a){const b=parseInt(a.slice(1,3),16),c=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);return{r:b,g:c,b:a}}}const nc=".salesforce.com .force.com .sfdc.net .site.com .salesforce-sites.com .crm.dev".split(" "),Oa={JWT:"JWT"},
hb=document.title;let da,Fb=!1,I=!1,O=!1,Da=!1,Ca=!1,M={},Y={},K,H,v,A,Ba,Aa=new Promise(a=>{Ba=a}),bb;const ec=new Promise(a=>{bb=a});let cb,oc=new Promise(a=>{cb=a}),U,N,ia,Ma;const C={JWT:"JWT",FAILED_OUTBOUND_MESSAGE_ENTRIES:"FAILED_MESSAGES",CONVERSATION_BUTTON_CLICK_TIME:"CONVERSATION_BUTTON_CLICK_TIME"},ka={ENTER:"Enter",TAB:"Tab",SPACE:" "},Ra=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,
xb={AURA:"AURA",LWR:"LWR"};let la,aa,Z,ma,xa={currentStateLogs:[],errorLogs:[]},db,Gb=new Promise(a=>{db=a});B.prototype.removeEventHandlers=function(){window.removeEventListener("message",Ya);window.removeEventListener("storage",Za);pa()&&window.$A.eventService&&w()===x.EXP_SITE_AUTH&&window.$A.eventService.removeHandler({event:"force:logout",handler:$a})};B.prototype.emitEmbeddedMessagingReadyEvent=function(){I=!0;try{y("onEmbeddedMessagingReady")}catch(a){I=!1,l("emitEmbeddedMessagingReadyEvent",
`Something went wrong in firing onEmbeddedMessagingReady event ${a}.`)}};B.prototype.removeMarkup=function(a){const b=D(),c=z(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingMinimizedNotification"),h=R(),m=document.getElementById("inert-script");b?b.parentNode.removeChild(b):r("Embedded Messaging iframe not available for resetting the client to initial state.");embeddedservice_bootstrap.filePreviewFrame&&embeddedservice_bootstrap.filePreviewFrame.parentNode?
embeddedservice_bootstrap.filePreviewFrame.parentNode.removeChild(embeddedservice_bootstrap.filePreviewFrame):r("Embedded Messaging file preview iframe not available for resetting the client to initial state.");a&&embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.parentNode?embeddedservice_bootstrap.siteContextFrame.parentNode.removeChild(embeddedservice_bootstrap.siteContextFrame):r("Embedded Messaging site context iframe not available for resetting the client to initial state.");
d&&d.parentNode.removeChild(d);document.body.classList.contains("embeddedMessagingPreventScrolling")&&(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));c?c.parentNode.removeChild(c):r("Embedded Messaging static button not available for resetting the client to initial state.");e&&e.parentNode.removeChild(e);h&&h.parentNode.removeChild(h);m&&m.parentNode.removeChild(m);
embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent();qa()};Sa.prototype.setIdentityToken=function(a){let b;if(!I)return l("setIdentityToken","Method can\u2019t be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(w()!==x.AUTH)return l("setIdentityToken","User Verification isn\u2019t enabled in Messaging Settings."),!1;if(!a||null===a||"object"!==typeof a)return l("setIdentityToken","Invalid identity token parameter passed into the setIdentityToken method. Specify a valid object containing the token data."),
!1;b=a.identityTokenType;a=a.identityToken;if("string"!==typeof b||b.trim().toUpperCase()!==Oa.JWT)return l("setIdentityToken","Unsupported identity token. Only JWT-based identity tokens are supported."),!1;let c=!1;switch(b){case Oa.JWT:c=sa(a)}if(!c)return l("setIdentityToken","Invalid identity token passed into the setIdentityToken method."),!1;H=a;ma&&"function"===typeof ma&&(ma(),ma=void 0);D()?t("EMBEDDED_MESSAGING_SET_IDENTITY_TOKEN_EVENT",H):z()?z()&&document.getElementById("embeddedMessagingIconRefresh")&&
(embeddedservice_bootstrap.removeMarkup(),embeddedservice_bootstrap.generateMarkup()):embeddedservice_bootstrap.generateMarkup();return!0};Sa.prototype.clearSession=function(){return new Promise((a,b)=>{la=a;I?Ha(ca(),!1):(b("Method can't be invoked before the onEmbeddedMessagingReady event is fired."),l("clearSession","Method cannot be invoked before the onEmbeddedMessagingReady event is fired."))})};na.prototype.setHiddenPrechatFields=function(a){if(za("setHiddenPrechatFields"))if(a&&"object"===
typeof a)for(const [b,c]of Object.entries(a))Db("setHiddenPrechatFields",b,c)&&(M[b]=c,n("setHiddenPrechatFields",`[setHiddenPrechatFields] Successfully updated Hidden Pre-Chat field ${b}.`));else l("setHiddenPrechatFields","When calling setHiddenPrechatFields, you must pass in an object with key-value pairs.")};na.prototype.removeHiddenPrechatFields=function(a){za("removeHiddenPrechatFields")&&(a&&Array.isArray(a)?a.forEach(function(b){M.hasOwnProperty(b)?(delete M[b],n("removeHiddenPrechatFields",
`[removeHiddenPrechatFields] Successfully removed Hidden Pre-Chat field ${b}.`)):l("removeHiddenPrechatFields",`removeHiddenPrechatFields called with an invalid field name ${b}.`)}):l("removeHiddenPrechatFields","When calling removeHiddenPrechatFields, you must pass in an array of fields."))};na.prototype.setVisiblePrechatFields=function(a){if(za("setVisiblePrechatFields")){var b=V();if(a&&"object"===typeof a&&!Array.isArray(a)){a=Object.entries(a);for(const [c,d]of a)if(Db("setVisiblePrechatFields",
c,d.value,d.isEditableByEndUser)){const e=b.find(h=>h.name===c);e.value=d.value;"boolean"===typeof d.isEditableByEndUser&&(e.isEditableByEndUser=d.isEditableByEndUser);n("setVisiblePrechatFields",`[setVisiblePrechatFields] Successfully updated Visible Pre-Chat field ${c}.`)}a.length&&Gb.then(()=>{t("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",V())})}else l("setVisiblePrechatFields","setVisiblePrechatFields was called with an invalid object. Pass in an object with key-value pairs.")}};na.prototype.unsetVisiblePrechatFields=
function(a){if(za("unsetVisiblePrechatFields")){var b=V();a&&Array.isArray(a)&&a.length?(a.forEach(c=>{const d=b.find(e=>e.name===c);d?(delete d.value,delete d.isEditableByEndUser,n("unsetVisiblePrechatFields",`[unsetVisiblePrechatFields] Successfully unset Visible Pre-Chat field ${c}.`)):l("unsetVisiblePrechatFields",`unsetVisiblePrechatFields was called with an invalid field name: ${c}. Enter a valid field name to remove.`)}),Gb.then(()=>{t("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",V())})):
l("unsetVisiblePrechatFields","When calling unsetVisiblePrechatFields, you must pass in an array of fields.")}};Ta.prototype.setAutoResponseParameters=function(a){if(Eb("setAutoResponseParameters"))if(a&&"object"===typeof a)for(const [c,d]of Object.entries(a)){a=c;var b=d;"string"!==typeof a||1>a.trim().length?(l("validateAutoResponseParameter",`Expected a non-empty string for the parameter name, but received ${typeof a}`),a=!1):"string"!==typeof b||1>b.trim().length?(l("validateAutoResponseParameter",
`Expected a non-empty string for the parameter value, but received ${typeof b}`),a=!1):a=!0;a?(Y[c]=d,n("setAutoResponseParameters",`[setAutoResponseParameters] Successfully updated auto-response parameter ${c}`)):r(`[setAutoResponseParameters] Failed to validate auto-response parameter ${c}`)}else l("setAutoResponseParameters","[setAutoResponseParameters] Must pass in an object of parameters as key-value pairs.")};Ta.prototype.removeAutoResponseParameters=function(a){Eb("removeAutoResponseParameters")&&
(a&&Array.isArray(a)?a.forEach(function(b){Y.hasOwnProperty(b)?(delete Y[b],n("removeAutoResponseParameters",`[removeAutoResponseParameters] Successfully removed auto-response parameter ${b}`)):r(`[removeAutoResponseParameters] Failed to validate auto-response parameter ${b}`)}):l("removeAutoResponseParameters","[removeAutoResponseParameters] Must pass in an array of parameter names."))};W.prototype.prefetchResources=zb;W.prototype.showChatButton=function(){var a=w();if(!I)return l("showChatButton",
"Method can't be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(a===x.UNAUTH||H){if(a=z())return a.style.display="block",!0;ja()&&qa(!0)}else l("showChatButton","Can't call showChatButton for a verified user before calling the setIdentity method with a valid token.");return!1};W.prototype.hideChatButton=function(){if(!I)return l("hideChatButton","Method can't be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(D())l("hideChatButton","Can\u2019t call hideChatButton once the messaging window is showing.");
else{const a=z();if(a)return a.style.display="none",!0;ja()&&qa(!1)}return!1};W.prototype.launchChat=function(){return new Promise((a,b)=>{let c;const d=()=>{let h;O?(h="[Launch Chat API] Successfully initialized the messaging client.",n("launchChat",h),a(h),window.removeEventListener("onEmbeddedMessagingInitSuccess",d),window.removeEventListener("onEmbeddedMessagingInitError",e)):(h="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",r(h),b(h))},e=
()=>{let h;O?(h="[Launch Chat API] Error launching the messaging client.",l("handleBootstrapError",h),b(h),window.removeEventListener("onEmbeddedMessagingInitSuccess",d),window.removeEventListener("onEmbeddedMessagingInitError",e),Q()):(h="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",r(h),b(h))};try{if(I){if(!z())if(ja())embeddedservice_bootstrap.generateMarkup(!0);else{c="[Launch Chat API] Default chat button isn\u2019t present. Check if the messaging client initialized successfully.";
r(c);b(c);return}if(D()){let h=D();h&&h.classList&&h.classList.contains("isMinimized")?(t("ESW_APP_MAXIMIZE"),n("launchChat","[Launch Chat API] Successfully maximized the messaging client."),a("[Launch Chat API] Successfully maximized the messaging client.")):(c="[Launch Chat API] The messaging client window is already present and maximized.",n("launchChat",c),r(c),a(c))}else window.addEventListener("onEmbeddedMessagingInitSuccess",d),window.addEventListener("onEmbeddedMessagingInitError",e),gb().catch(h=>
{c=`[Launch Chat API] Error when API simulates clicking the custom messaging client button: ${h}`;l("launchChat",c);b(c)})}else c="[Launch Chat API] Can\u2019t invoke API before the onEmbeddedMessagingReady event is fired.",r(c),b(c)}catch(h){c=`[Launch Chat API] Something went wrong launching the API: ${h}`,l("launchChat",c),b(c)}})};W.prototype.sendTextMessage=function(a){return new Promise((b,c)=>{try{Da?(aa=b,Z=c,t("EMBEDDED_MESSAGING_PUBLIC_SEND_TEXT_MESSAGE_API_REQUEST",a)):(l("sendTextMessage",
"[Send Text Message API] Can\u2019t invoke API before the onEmbeddedMessagingConversationOpened event is fired."),c("[Send Text Message API] Can\u2019t invoke API before the onEmbeddedMessagingConversationOpened event is fired."))}catch(d){Z=aa=void 0,b=`[Send Text Message API] Something went wrong sending text message: ${d}`,l("sendTextMessage",b),c(b)}})};B.prototype.isValidEntityId=function(a){return"string"===typeof a&&(18===a.length||15===a.length)};B.prototype.getKeyPrefix=function(a){if(embeddedservice_bootstrap.isValidEntityId(a))return a.substr(0,
3)};B.prototype.isOrganizationId=function(a){return"00D"===embeddedservice_bootstrap.getKeyPrefix(a)};B.prototype.isMessageFromSalesforceDomain=function(a){var b=a.split(":")[1].replace("//","");if(wa()&&b===document.domain)return!0;var c=function(d,e){return-1!==d.indexOf(e,d.length-e.length)};return nc.some(function(d){return c(b,d)})};B.prototype.generateMarkup=function(a=!1){var b=document.createDocumentFragment(),c=R(),d=z();if(ja()&&!a)qa();else if(!c||!d){c=document.createElement("div");c.id=
"embedded-messaging";c.className="embedded-messaging";a=document.createElement("div");d=document.createElement("button");pb.isValidContrastRatio("#FFFFFF",S("headerColor"))||document.documentElement.style.setProperty("--eswIconFillColor","#1A1B1E");var e=document.createElement("div");const h=Ga(ya.CHAT);h.setAttribute("id","embeddedMessagingIconChat");h.setAttribute("class","embeddedMessagingIconChat");e.id="embeddedMessagingIconContainer";e.className="embeddedMessagingIconContainer";e.appendChild(h);
a.className="embeddedMessagingConversationButtonWrapper";d.classList.add("embeddedMessagingConversationButton");d.id="embeddedMessagingConversationButton";d.href="javascript:void(0)";d.addEventListener("click",fb);d.addEventListener("keydown",hc);d.setAttribute("tabindex",0);d.setAttribute("role","button");d.setAttribute("aria-label",E("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||"Hello, have a question? Let\u2019s chat.");d.setAttribute("title",E("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||
"Hello, have a question? Let\u2019s chat.");d.style.setProperty("--eswHeaderColor",S("headerColor"));d.style.setProperty("--eswSecondaryColor",S("secondaryColor"));embeddedservice_bootstrap.settings.hasBottomTabBar&&d.classList.add("embeddedMessagingBottomTabBar");!ra()&&Ia()&&!embeddedservice_bootstrap.settings.hideChatButtonOnLoad||q(C.JWT)||(d.style.display="none");embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&
d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());wa()&&d.classList.add("experienceSite");d.appendChild(e);a.appendChild(d);d=a;b.appendChild(c);c.appendChild(d);embeddedservice_bootstrap.settings.targetElement.appendChild(b);try{y("onEmbeddedMessagingButtonCreated")}catch(m){l("onEmbeddedMessagingButtonCreated",`Something went wrong in firing onEmbeddedMessagingButtonCreated event ${m}.`)}document.getElementById("inert-script")||(b=document.createElement("script"),
c=`${J()}/assets/js/inert${embeddedservice_bootstrap.settings.devMode?"":".min"}.js`,b.id="inert-script",b.type="text/javascript",b.src=c,embeddedservice_bootstrap.settings.targetElement.appendChild(b))}};B.prototype.createFilePreviewFrame=function(){const a=document.createElement("iframe"),b=new URL(`${J()}/assets/htdocs/filepreview${embeddedservice_bootstrap.settings.devMode?"":".min"}.html`);b.searchParams.set("parent_domain",window.location.origin);a.classList.add("embeddedMessagingFilePreviewFrame");
a.id="embeddedMessagingFilePreviewFrame";a.name="embeddedMessagingFilePreviewFrame";a.src=b.href;a.title=E("EmbeddedMessagingIframesAndContents","FilePreviewIframeTitle")||"Enlarged image preview";a.onload=()=>{n("createFilePreviewFrame","Created an iframe for file preview.")};embeddedservice_bootstrap.filePreviewFrame=a;document.body.appendChild(a)};B.prototype.createIframe=function(){return new Promise((a,b)=>{try{const c=R(),d=document.createElement("iframe"),e=kc();d.title=E("EmbeddedMessagingIframesAndContents",
"MessagingIframeTitle")||"Chat with an Agent";d.className="embeddedMessagingFrame";d.id="embeddedMessagingFrame";d.onload=a;d.onerror=b;d.style.backgroundColor="transparent";d.allowTransparency="true";d.setAttribute("aria-label",E("EmbeddedMessagingChatHeader","ChatWindowAssistiveText")||"Chat Window");d.setAttribute("role","dialog");d.setAttribute("aria-modal","true");ra()&&d.classList.add("embeddedMessagingFrameInline");embeddedservice_bootstrap.settings.omitSandbox||(d.sandbox="allow-scripts allow-same-origin allow-modals allow-downloads allow-popups allow-popups-to-escape-sandbox");
embeddedservice_bootstrap.settings.isAuraSite?fc(d):gc(d);embeddedservice_bootstrap.settings.hasBottomTabBar&&(d.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),d.classList.add("embeddedMessagingFrameMaximizedBottomTabBar"));navigator.userAgent.includes("CommunityHybridContainer")||navigator.userAgent.includes("playgroundcommunity")?d.classList.add("mobilePublisher"):wa()&&d.classList.add("experienceSite");embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===
typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());d.onload=()=>{n("createIframe","Created Embedded Messaging frame.")};c.appendChild(e);c.appendChild(d)}catch(c){b(c)}})};B.prototype.bootstrapEmbeddedMessaging=function(){try{return embeddedservice_bootstrap.utilAPI.launchChat()}catch(a){throw Error("[Bootstrap API] Something went wrong bootstrapping Embedded Messaging: "+
a);}};B.prototype.maximizeIframe=function(a){const b=z();var c=document.getElementById("embeddedMessagingModalOverlay");const d=document.getElementById("embeddedMessagingIconChat"),e=document.getElementById("embeddedMessagingIconContainer"),h=document.querySelector('meta[name="viewport"]'),m=!!navigator.userAgent.match(/iP(hone|ad|od)/i);a&&(a.classList.add("isMaximized"),a.classList.remove("isMinimized"),a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&
(a.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),a.classList.add("embeddedMessagingFrameMaximizedBottomTabBar")));b&&(b.style.display="none",b.setAttribute("tabindex",-1),b.setAttribute("aria-label",E("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),b.setAttribute("title",E("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),d.style.display="none",document.getElementById("embeddedMessagingIconMinimize")||
(a=Ga(ya.MINIMIZE_MODAL),a.setAttribute("id","embeddedMessagingIconMinimize"),a.setAttribute("class","embeddedMessagingIconMinimize"),e.insertBefore(a,d)));c&&!c.classList.contains("isMaximized")&&c.classList.add("isMaximized");-1===navigator.userAgent.indexOf("Mobi")||document.body.classList.contains("embeddedMessagingPreventScrolling")||(document.scrollingElement?embeddedservice_bootstrap.documentScrollPosition=document.scrollingElement.scrollTop:(c=document.documentElement.getBoundingClientRect(),
embeddedservice_bootstrap.documentScrollPosition=Math.abs(c.top)),document.body.classList.add("embeddedMessagingPreventScrolling"));m&&h?(U=h.content,h.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1")):"Android"===Pa().os.name&&"Chrome"===Pa().browser.name&&h&&(U=h.content,h.setAttribute("content","width=device-width, initial-scale=1, minimum-scale=1, interactive-widget=resizes-content"));Ra.test(navigator.userAgent)&&Qa(!0);t("ESW_APP_MAXIMIZATION_RESIZING_COMPLETED");
n("maximizeIframe","Maximized the app");y("onEmbeddedMessagingWindowMaximized")};B.prototype.minimizeIframe=function(a,b){const c=z(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingIconMinimize");b=b.hasMinimizedNotification;a&&(a.classList.remove("isMaximized"),a.classList.add("isMinimized"),b?a.classList.add("hasMinimizedNotification"):a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&(a.classList.remove("embeddedMessagingFrameMaximizedBottomTabBar"),
a.classList.add("embeddedMessagingFrameMinimizedBottomTabBar")));e&&e.remove();c&&(c.style.display="none",c.setAttribute("tabindex",-1),c.removeAttribute("title"),c.removeAttribute("aria-label"));d&&d.classList.contains("isMaximized")&&d.classList.remove("isMaximized");-1!==navigator.userAgent.indexOf("Mobi")&&(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));U&&
yb();Ra.test(navigator.userAgent)&&Qa(!1);t("ESW_APP_MINIMIZATION_RESIZING_COMPLETED");n("minimizeIframe","Minimized the app");y("onEmbeddedMessagingWindowMinimized")};B.prototype.initializeFeatureObjects=function(){embeddedservice_bootstrap.prechatAPI=new na;embeddedservice_bootstrap.autoResponseAPI=new Ta;embeddedservice_bootstrap.userVerificationAPI=new Sa;embeddedservice_bootstrap.utilAPI=new W};B.prototype.init=function(a,b,c,d){if(Fb)l("init","Attempted to initialize bootstrap multiple times",
null,!0);else{Fb=!0;try{embeddedservice_bootstrap.settings.orgId=a;embeddedservice_bootstrap.settings.eswConfigDevName=b;embeddedservice_bootstrap.settings.siteURL=c;embeddedservice_bootstrap.settings.snippetConfig=d;A=Wa();n("init",`Initialized a new conversationId: ${A}`);Xa(d||{});if("string"!==typeof embeddedservice_bootstrap.settings.siteURL||!embeddedservice_bootstrap.settings.siteURL.length)throw Error(`Expected a valid Site URL value to be a string but received: ${embeddedservice_bootstrap.settings.siteURL}.`);
if("string"!==typeof embeddedservice_bootstrap.settings.scrt2URL||!embeddedservice_bootstrap.settings.scrt2URL.length)throw Error(`Expected a valid SCRT 2.0 URL value to be a string but received: ${embeddedservice_bootstrap.settings.scrt2URL}.`);if(!embeddedservice_bootstrap.settings.orgId||!embeddedservice_bootstrap.isOrganizationId(embeddedservice_bootstrap.settings.orgId))throw Error("Invalid OrganizationId Parameter Value: "+embeddedservice_bootstrap.settings.orgId);if("string"!==typeof embeddedservice_bootstrap.settings.eswConfigDevName||
!embeddedservice_bootstrap.settings.eswConfigDevName.length)throw Error(`Expected a valid ESW Config Dev Name value to be a string but received: ${embeddedservice_bootstrap.settings.eswConfigDevName}.`);try{window.localStorage}catch(k){r("localStorage is not available. User chat sessions continue only in a single-page view and not across multiple pages."),embeddedservice_bootstrap.isLocalStorageAvailable=!1}try{window.sessionStorage}catch(k){r("sessionStorage is not available. User chat sessions end after a web page refresh or across browser tabs and windows."),
embeddedservice_bootstrap.isSessionStorageAvailable=!1}Jb();if(!embeddedservice_bootstrap.settings.targetElement)throw Error("No targetElement specified.");Kb();ac();embeddedservice_bootstrap.settings.hasBottomTabBar=cc();embeddedservice_bootstrap.settings.isAuraSite=!!embeddedservice_bootstrap.settings.isAuraSite;embeddedservice_bootstrap.settings.omitSandbox=!!embeddedservice_bootstrap.settings.omitSandbox;embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel=!!embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel;
embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab=!!embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab;const e=ib().then(Promise.resolve.bind(Promise),()=>ib(J())).catch(()=>{L();throw Error("Error loading CSS.");}),h=jb().then(k=>{n("init","Successfully retrieved configuration settings");Xa(k);k=embeddedservice_bootstrap.settings.embeddedServiceConfig;embeddedservice_bootstrap.brandingData=k&&k.branding?k.branding:[];embeddedservice_bootstrap.settings.embeddedServiceConfig.scrt2URL=
embeddedservice_bootstrap.settings.scrt2URL;embeddedservice_bootstrap.settings.embeddedServiceConfig.orgId=embeddedservice_bootstrap.settings.orgId;if(!embeddedservice_bootstrap.settings.embeddedServiceConfig)throw Error("Embedded Service Config settings not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.name)throw Error("Embedded Service Config developer name not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel)throw Error("Embedded Service Messaging Channel settings not present in configuration response.");
if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode)throw Error("Auth mode setting not present in configuration response.");if(!Object.values(x).includes(embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode))throw Error("Auth mode in configuration response is invalid.");wa()&&embeddedservice_bootstrap.settings.expSiteAuthMode&&(embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode=
x.EXP_SITE_AUTH);v=`${embeddedservice_bootstrap.settings.orgId}_WEB_STORAGE`;mc()},k=>{l("init","Failed to retrieve configuration settings. Retrying the request");return new Promise((ea,P)=>{jb().then(ea,P)})}).catch(()=>{L();throw Error("Unable to load Embedded Messaging configuration.");});h.then(()=>{X("ESW_3RDPARTY_STORAGE_REQUEST",{orgId:embeddedservice_bootstrap.settings.orgId});embeddedservice_bootstrap.settings.disablePrefetch||zb()});const m=Ka().then(Promise.resolve.bind(Promise),k=>kb(k)).catch(k=>
{l("init","Failed to retrieve Business Hours data.",k);L();throw Error("Failed to retrieve Business Hours data.");});Promise.all([e,h,m,oc]).then(()=>{p();if(embeddedservice_bootstrap.isLocalStorageAvailable){var k=Object.keys(JSON.parse(localStorage.getItem(v)));n("logWebStorageItemsOnInit",`Local storage items on init: ${k}`)}embeddedservice_bootstrap.isSessionStorageAvailable&&(k=Object.keys(JSON.parse(sessionStorage.getItem(v))),n("logWebStorageItemsOnInit",`Session storage items on init: ${k}`));
embeddedservice_bootstrap.initializeFeatureObjects();embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent();w()===x.EXP_SITE_AUTH?lb():q(C.JWT)?mb():w()===x.UNAUTH&&embeddedservice_bootstrap.generateMarkup();ra()&&embeddedservice_bootstrap.utilAPI.launchChat()})}catch(e){L(),l("init",`Error: ${e}`)}}};window.embeddedservice_bootstrap?l("bootstrap load","attempting to load MIAW script when one is already loaded",null,!0):window.embeddedservice_bootstrap=new B})();
